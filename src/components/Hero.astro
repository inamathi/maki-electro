---
import LogoMecJa from "../assets/logoMecJa.svg";
import { withBaseSafe } from "@/lib/withBase";
const heroImages = [
  "/images/bgimg_hero-01.webp",
  "/images/bgimg_hero-02.webp",
  "/images/bgimg_hero-03.webp",
  "/images/bgimg_hero-04.webp",
  "/images/bgimg_hero-05.webp",
  "/images/bgimg_hero-06.webp",
  "/images/bgimg_hero-07.webp",
  "/images/bgimg_hero-08.webp",
].map(withBaseSafe);

const lottieSrc = withBaseSafe("/animations/strokelogoMecJa.json");
---

<div class="hero-container">
  <div class="hero-wrapper">
    <div id="hero-logo" class="hero-logo">
      <lottie-player
        src={lottieSrc}
        background="transparent"
        speed="1"
        style="width: 220px; height: 140px"
        autoplay></lottie-player>
      <!-- ※SVGロゴに差し替えたい場合は下行を活かして置き換え -->
      <!-- <LogoMecJa class="hero-logo-svg" /> -->
    </div>

    <p class="hero-lead">
      株式会社マキエレクトロは、水晶関連商品の販売及び<br />
      特注製品の受注販売を行っている電子部品商社です。<br />
      国内および海外メーカーの水晶関連製品各種を取り扱っております。<br />
      その他、半導体をはじめ各種電子部品の取り扱い、<br
      />基板設計から製作・検査等、基板製作のお手伝いまで対応しております。
    </p>

    {
      heroImages.map((src, index) => (
        <img
          src={src}
          alt={`Hero ${index + 1}`}
          class={`hero-image${index === 0 ? " active" : ""}`}
          data-index={index}
          loading={index === 0 ? "eager" : "lazy"}
          decoding="async"
        />
      ))
    }

    <!-- コントラスト強化のための上乗せグラデ（任意） -->
    <div class="hero-overlay"></div>
  </div>
</div>

<style lang="scss">
  @use "../styles/var" as var;

  /* ===== モバイル優先（~1023px） ===== */
  .hero-container {
    position: relative;
    width: 100vw;
    /* 端末のアドレスバー高に追従。最小/最大で揺れを抑制 */
    height: clamp(56svh, 64svh, 72svh);
    overflow: clip; /* iOSでのスクロールオーバーラン対策 */
    display: flex;
    justify-content: center;
    // padding-inline: max(16px, env(safe-area-inset-left));
    // padding-inline: max(16px, env(safe-area-inset-right));
    // padding-block: 16px;

    .hero-wrapper {
      width: 100%;
      height: 100%;
      position: relative;

      .hero-logo {
        position: relative;
        z-index: 20;
        margin-inline: auto;
        /* 上部に配置（モバイル） */
        margin-top: clamp(8px, 4vh, 24px);
        width: clamp(180px, 48vw, 260px);
        display: grid;
        place-items: center;

        lottie-player,
        .hero-logo-svg {
          width: 100% !important;
          height: auto !important;
          /* アンチエイリアスのにじみ軽減 */
          image-rendering: -webkit-optimize-contrast;
        }
      }

      .hero-lead {
        position: absolute;
        inset-inline: 50%;
        bottom: 0%;
        transform: translateX(-50%);
        // max-width: min(92%, 720px);
        width: 100vw;
        color: var.$color-textnega;
        text-align: left;

        /* 読みやすさと回り込みの柔軟性 */
        font-size: clamp(0.85rem, 2.6vw, 1.05rem);
        line-height: 1.9;
        letter-spacing: 0.01em;

        /* ガラス風。モバイルで強すぎない程度に */
        background: color-mix(in srgb, #000 30%, transparent);
        border: 1px solid rgba(0, 0, 0, 0.5);
        // padding: clamp(12px, 3.2vw, 20px) clamp(16px, 4.4vw, 40px);
        // border-radius: 14px;
        padding: 10px 16px;
        border-radius: 0;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);

        opacity: 0;
        animation: fadeInUp 900ms ease-out forwards;
        animation-delay: 700ms;
        z-index: 15;

        /* ブレの少ない改行 */
        br {
          content: "";
        }
      }
    }

    /* 背景画像（フェード） */
    .hero-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      will-change: opacity;
      transition: opacity 1200ms ease-in-out;
      /* 画像の色被りをやわらげてロゴ/リードを浮かせる */
      filter: saturate(1.05) contrast(1.02);
    }
    .hero-image.active {
      opacity: 1;
      z-index: 1;
    }

    /* 上からのディム&下からのグラデで文字の視認性を担保 */
    .hero-overlay {
      pointer-events: none;
      position: absolute;
      inset: 0;
      z-index: 2;
      background: linear-gradient(
        180deg,
        rgba(0, 0, 0, 0.45) 0%,
        rgba(0, 0, 0, 0.25) 20%,
        rgba(0, 0, 0, 0.12) 45%,
        rgba(0, 0, 0, 0.25) 100%
      );
      mix-blend-mode: normal;
    }
  }

  /* フェードイン */
  @keyframes fadeInUp {
    from {
      transform: translate(-50%, 16%);
      opacity: 0;
    }
    to {
      transform: translate(-50%, 0);
      opacity: 1;
    }
  }

  /* ===== PC（>=1024px） ===== */
  @media (min-width: 1024px) {
    .hero-container {
      height: clamp(60vh, 70vh, 100vw);
      .hero-wrapper {
        .hero-logo {
          /* PCは右上寄りに配置（好みで中央のままでもOK） */
          position: absolute;
          top: clamp(24px, 8vh, 80px);
          right: clamp(20px, 6vw, 120px);
          margin: 0;
          width: clamp(260px, 22vw, 360px);
        }

        .hero-lead {
          bottom: clamp(5%, 10vh, 14%);
          max-width: min(72%, 920px);
          font-size: clamp(1rem, 1.25vw, 1.2rem);
          line-height: 2.2;
          padding: clamp(16px, 1.5vw, 28px) clamp(24px, 2.6vw, 48px);
          border-radius: 16px;
          /* PCは少し透明度を下げる（背景を見せる） */
          background: color-mix(in srgb, #000 24%, transparent);
          text-align: center;
        }
      }

      .hero-overlay {
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.38) 0%,
          rgba(0, 0, 0, 0.18) 36%,
          rgba(0, 0, 0, 0.1) 56%,
          rgba(0, 0, 0, 0.22) 100%
        );
      }
    }
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const slides = document.querySelectorAll(".hero-image");
    if (!slides.length) return;

    const reduceMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)"
    ).matches;
    let current = 0;
    let timerId = null;
    const DURATION = 5000;

    const show = (i) => {
      slides[current]?.classList.remove("active");
      current = i;
      slides[current]?.classList.add("active");
    };

    const next = () => show((current + 1) % slides.length);

    const start = () => {
      if (reduceMotion) return; // アニメを抑制
      stop();
      timerId = setInterval(next, DURATION);
    };
    const stop = () => {
      if (timerId) clearInterval(timerId);
      timerId = null;
    };

    // 初期表示
    show(0);
    start();

    // タブが非表示の間は停止（省電力＆無駄描画防止）
    document.addEventListener("visibilitychange", () => {
      if (document.hidden) stop();
      else start();
    });

    // 画面回転・リサイズで一瞬止めて再開（モバイルのちらつき対策）
    let resizeTimer;
    window.addEventListener(
      "resize",
      () => {
        if (reduceMotion) return;
        stop();
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(start, 400);
      },
      { passive: true }
    );
  });
</script>

<!-- Lottie（CDN） -->
<script
  src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"
></script>
